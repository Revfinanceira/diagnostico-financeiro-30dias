<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula 4: Ca√ßando Vazamentos Financeiros - Revolu√ß√£o Financeira em 30 Dias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .progress-container {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 2px solid #e9ecef;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 10px;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 4px;
            background: #e9ecef;
            z-index: 1;
        }

        .progress-line-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 4px solid #e9ecef;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #adb5bd;
            transition: all 0.3s ease;
        }

        .progress-step.active .progress-circle {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }

        .progress-step.completed .progress-circle {
            border-color: #28a745;
            background: #28a745;
            color: white;
        }

        .progress-label {
            font-size: 0.85em;
            color: #6c757d;
            font-weight: 500;
        }

        .progress-step.active .progress-label {
            color: #667eea;
            font-weight: 600;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 2em;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .step-description {
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box {
            background: #e0e7ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: #4c51bf;
            margin: 5px 0;
            line-height: 1.6;
        }

        .info-box strong {
            color: #667eea;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box p {
            color: #92400e;
            margin: 5px 0;
            line-height: 1.6;
        }

        .leak-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
            border-left: 4px solid #ef4444;
        }

        .leak-item.low-impact {
            border-left-color: #fbbf24;
        }

        .leak-item.high-impact {
            border-left-color: #dc2626;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.95em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .remove-button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .remove-button:hover {
            background: #dc2626;
        }

        .add-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .add-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .nav-button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .nav-button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .nav-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .nav-button.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .nav-button.secondary:hover {
            background: #f0f4ff;
        }

        .impact-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid;
        }

        .impact-card.automatic {
            border-left-color: #ef4444;
        }

        .impact-card.convenience {
            border-left-color: #f59e0b;
        }

        .impact-card.status {
            border-left-color: #8b5cf6;
        }

        .impact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .impact-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #2d3748;
        }

        .impact-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
        }

        .impact-badge.automatic {
            background: #ef4444;
        }

        .impact-badge.convenience {
            background: #f59e0b;
        }

        .impact-badge.status {
            background: #8b5cf6;
        }

        .impact-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .value-box {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .value-label {
            font-size: 0.85em;
            color: #718096;
            margin-bottom: 5px;
        }

        .value-amount {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        .rating-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .rating-stars {
            display: flex;
            gap: 5px;
        }

        .star {
            font-size: 1.5em;
            cursor: pointer;
            color: #d1d5db;
            transition: color 0.2s;
        }

        .star.active {
            color: #fbbf24;
        }

        .top-leaks-summary {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 3px solid #f59e0b;
        }

        .summary-title {
            font-size: 1.8em;
            color: #92400e;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .total-leak {
            text-align: center;
            margin: 20px 0;
        }

        .total-leak-label {
            font-size: 1em;
            color: #92400e;
            margin-bottom: 10px;
        }

        .total-leak-value {
            font-size: 3em;
            font-weight: 700;
            color: #dc2626;
        }

        .download-section {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .download-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .download-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* Estilos para impress√£o */
        .print-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 9999;
            overflow-y: auto;
            padding: 40px;
        }

        .print-view.active {
            display: block !important;
        }

        .print-content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .print-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .print-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10000;
        }
        
        .print-view:not(.active) .print-buttons {
            display: none;
        }
        
        .print-view.active .print-buttons {
            display: flex !important;
        }

        .print-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .print-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .print-btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        @media print {
            .print-buttons {
                display: none !important;
            }
            
            .print-content {
                box-shadow: none;
                padding: 0;
            }
            
            .print-view {
                padding: 0;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .impact-values {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Aula 4: Ca√ßando Vazamentos Financeiros</h1>
            <p>Identifique e elimine desperd√≠cios invis√≠veis que est√£o sabotando seus sonhos</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-line">
                    <div class="progress-line-fill" id="progressFill"></div>
                </div>
                <div class="progress-step active" data-step="1">
                    <div class="progress-circle">1</div>
                    <div class="progress-label">Autom√°ticos</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="progress-circle">2</div>
                    <div class="progress-label">Conveni√™ncia</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="progress-circle">3</div>
                    <div class="progress-label">Status</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="progress-circle">4</div>
                    <div class="progress-label">Top 3</div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- PASSO 1: VAZAMENTOS AUTOM√ÅTICOS -->
            <div class="step active" id="step1">
                <h2 class="step-title">üîÑ Passo 1: Vazamentos Autom√°ticos</h2>
                <p class="step-description">Identifique despesas recorrentes que acontecem sem decis√£o ativa.</p>

                <div class="info-box">
                    <p><strong>üí° O que s√£o Vazamentos Autom√°ticos?</strong></p>
                    <p>‚Ä¢ Assinaturas que voc√™ n√£o utiliza plenamente</p>
                    <p>‚Ä¢ Servi√ßos banc√°rios e taxas que podem ser reduzidas</p>
                    <p>‚Ä¢ Renova√ß√µes autom√°ticas com aumentos de pre√ßo</p>
                    <p><br><strong>Impacto:</strong> Brasileiros desperdi√ßam em m√©dia R$ 85/m√™s em assinaturas subutilizadas!</p>
                </div>

                <div class="section">
                    <div class="section-title">Seus Vazamentos Autom√°ticos</div>
                    <div id="automaticLeaksContainer"></div>
                    <button class="add-button" onclick="addLeak('automatic')">
                        ‚ûï Adicionar Vazamento Autom√°tico
                    </button>
                </div>

                <div class="navigation">
                    <button class="nav-button primary" onclick="nextStep()">
                        Pr√≥ximo: Vazamentos de Conveni√™ncia ‚Üí
                    </button>
                </div>
            </div>

            <!-- PASSO 2: VAZAMENTOS DE CONVENI√äNCIA -->
            <div class="step" id="step2">
                <h2 class="step-title">üõí Passo 2: Vazamentos de Conveni√™ncia</h2>
                <p class="step-description">Gastos extras pelo conforto do momento que se acumulam ao longo do tempo.</p>

                <div class="info-box">
                    <p><strong>üí° O que s√£o Vazamentos de Conveni√™ncia?</strong></p>
                    <p>‚Ä¢ Delivery em vez de buscar ou preparar</p>
                    <p>‚Ä¢ Compras por impulso de pequeno valor</p>
                    <p>‚Ä¢ Solu√ß√µes r√°pidas para problemas evit√°veis com planejamento</p>
                    <p><br><strong>Impacto:</strong> Um vazamento de R$ 10/dia representa R$ 3.650/ano!</p>
                </div>

                <div class="warning-box">
                    <p><strong>‚ö†Ô∏è Aten√ß√£o:</strong> N√£o se trata de eliminar todo conforto, mas de identificar gastos autom√°ticos que n√£o trazem valor proporcional.</p>
                </div>

                <div class="section">
                    <div class="section-title">Seus Vazamentos de Conveni√™ncia</div>
                    <div id="convenienceLeaksContainer"></div>
                    <button class="add-button" onclick="addLeak('convenience')">
                        ‚ûï Adicionar Vazamento de Conveni√™ncia
                    </button>
                </div>

                <div class="navigation">
                    <button class="nav-button secondary" onclick="prevStep()">
                        ‚Üê Voltar
                    </button>
                    <button class="nav-button primary" onclick="nextStep()">
                        Pr√≥ximo: Vazamentos de Status ‚Üí
                    </button>
                </div>
            </div>

            <!-- PASSO 3: VAZAMENTOS DE STATUS -->
            <div class="step" id="step3">
                <h2 class="step-title">üëî Passo 3: Vazamentos de Status</h2>
                <p class="step-description">Despesas motivadas principalmente por compara√ß√£o social ou para impressionar outros.</p>

                <div class="info-box">
                    <p><strong>üí° O que s√£o Vazamentos de Status?</strong></p>
                    <p>‚Ä¢ Upgrades desnecess√°rios de produtos</p>
                    <p>‚Ä¢ Marcas premium sem benef√≠cio proporcional</p>
                    <p>‚Ä¢ Produtos/servi√ßos adquiridos para impressionar</p>
                    <p><br><strong>Pergunta-chave:</strong> "Eu compraria isso se ningu√©m soubesse?"</p>
                </div>

                <div class="section">
                    <div class="section-title">Seus Vazamentos de Status</div>
                    <div id="statusLeaksContainer"></div>
                    <button class="add-button" onclick="addLeak('status')">
                        ‚ûï Adicionar Vazamento de Status
                    </button>
                </div>

                <div class="navigation">
                    <button class="nav-button secondary" onclick="prevStep()">
                        ‚Üê Voltar
                    </button>
                    <button class="nav-button primary" onclick="nextStep()">
                        Pr√≥ximo: Identificar Top 3 ‚Üí
                    </button>
                </div>
            </div>

            <!-- PASSO 4: TOP 3 VAZAMENTOS -->
            <div class="step" id="step4">
                <h2 class="step-title">üéØ Passo 4: Seus Top 3 Maiores Vazamentos</h2>
                <p class="step-description">Baseado em sua an√°lise, veja os vazamentos com maior impacto financeiro.</p>

                <div class="top-leaks-summary" id="topLeaksSummary">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>

                <div class="section">
                    <div class="section-title">Plano de A√ß√£o para Elimina√ß√£o</div>
                    
                    <div class="info-box">
                        <p><strong>‚úÖ Pr√≥ximos passos pr√°ticos:</strong></p>
                        <p>1. <strong>Cancele imediatamente</strong> assinaturas n√£o utilizadas</p>
                        <p>2. <strong>Negocie taxas</strong> banc√°rias com sua institui√ß√£o</p>
                        <p>3. <strong>Substitua h√°bitos caros</strong> por alternativas mais econ√¥micas</p>
                        <p>4. <strong>Redirecione a economia</strong> para sua Conta Sonhos</p>
                        <p>5. <strong>Revise mensalmente</strong> para evitar novos vazamentos</p>
                    </div>

                    <div id="actionPlanContainer"></div>
                </div>

                <div class="download-section">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">‚úÖ An√°lise Completa!</h3>
                    <p style="color: #718096; margin-bottom: 30px;">Visualize e salve seu Relat√≥rio de Vazamentos Financeiros</p>
                    <button class="download-button" onclick="showPrintView()">
                        üìÑ Ver Relat√≥rio Completo
                    </button>
                </div>

                <div class="navigation">
                    <button class="nav-button secondary" onclick="prevStep()">
                        ‚Üê Voltar
                    </button>
                    <button class="nav-button primary" onclick="restart()">
                        üîÑ Nova An√°lise
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visualiza√ß√£o para Impress√£o -->
    <div class="print-view" id="printView">
        <div class="print-buttons">
            <button class="print-btn print-btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir/Salvar PDF</button>
            <button class="print-btn print-btn-secondary" onclick="closePrintView()">‚úï Fechar</button>
        </div>
        <div class="print-content" id="printContent">
            <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>
    </div>

    <script>
        // Estado da aplica√ß√£o
        let currentStep = 1;
        let data = {
            automatic: [],
            convenience: [],
            status: []
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            updateProgressBar();
            renderAllLeaks();
        });

        // Navega√ß√£o
        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                showStep(currentStep);
                updateProgressBar();
                
                if (currentStep === 4) {
                    calculateTopLeaks();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateProgressBar();
            }
        }

        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgressBar() {
            const totalSteps = 4;
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });
        }

        // Gerenciamento de vazamentos
        function addLeak(type) {
            const id = Date.now();
            data[type].push({
                id,
                name: '',
                monthlyValue: 0,
                frequency: 'monthly',
                satisfaction: 5,
                wouldReverse: false,
                alignsWithDreams: true
            });
            renderLeaks(type);
            saveToLocalStorage();
        }

        function removeLeak(type, id) {
            data[type] = data[type].filter(leak => leak.id !== id);
            renderLeaks(type);
            saveToLocalStorage();
        }

        function updateLeak(type, id, field, value) {
            const leak = data[type].find(l => l.id === id);
            if (leak) {
                leak[field] = value;
                saveToLocalStorage();
                renderLeaks(type);
            }
        }

        function setRating(type, id, rating) {
            updateLeak(type, id, 'satisfaction', rating);
        }

        function renderLeaks(type) {
            const container = document.getElementById(`${type}LeaksContainer`);
            const leaks = data[type];

            if (leaks.length === 0) {
                container.innerHTML = '<p style="color: #718096; text-align: center; padding: 20px;">Nenhum vazamento identificado ainda</p>';
                return;
            }

            container.innerHTML = leaks.map(leak => {
                const yearlyValue = calculateYearlyValue(leak.monthlyValue, leak.frequency);
                const fiveYearImpact = yearlyValue * 5;

                return `
                    <div class="leak-item">
                        <button class="remove-button" onclick="removeLeak('${type}', ${leak.id})">‚úï</button>
                        
                        <div class="input-group">
                            <label>Descri√ß√£o do Vazamento</label>
                            <input type="text" 
                                   placeholder="Ex: Netflix que n√£o assisto, Caf√©s na padaria todo dia..."
                                   value="${leak.name}"
                                   onchange="updateLeak('${type}', ${leak.id}, 'name', this.value)">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="input-group">
                                <label>Valor</label>
                                <input type="number" 
                                       placeholder="50"
                                       value="${leak.monthlyValue || ''}"
                                       min="0"
                                       step="1"
                                       onchange="updateLeak('${type}', ${leak.id}, 'monthlyValue', parseFloat(this.value) || 0)">
                            </div>
                            <div class="input-group">
                                <label>Frequ√™ncia</label>
                                <select onchange="updateLeak('${type}', ${leak.id}, 'frequency', this.value)">
                                    <option value="daily" ${leak.frequency === 'daily' ? 'selected' : ''}>Por dia</option>
                                    <option value="weekly" ${leak.frequency === 'weekly' ? 'selected' : ''}>Por semana</option>
                                    <option value="monthly" ${leak.frequency === 'monthly' ? 'selected' : ''}>Por m√™s</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>Satisfa√ß√£o Proporcional (1-10)</label>
                            <div class="rating-container">
                                <div class="rating-stars">
                                    ${[1,2,3,4,5,6,7,8,9,10].map(rating => 
                                        `<span class="star ${leak.satisfaction >= rating ? 'active' : ''}" 
                                               onclick="setRating('${type}', ${leak.id}, ${rating})">‚òÖ</span>`
                                    ).join('')}
                                </div>
                                <span style="color: #667eea; font-weight: 600;">${leak.satisfaction}/10</span>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="input-group">
                                <label>
                                    <input type="checkbox" 
                                           ${leak.wouldReverse ? 'checked' : ''}
                                           onchange="updateLeak('${type}', ${leak.id}, 'wouldReverse', this.checked)"
                                           style="width: auto; margin-right: 8px;">
                                    Reverteria este gasto se pudesse?
                                </label>
                            </div>
                            <div class="input-group">
                                <label>
                                    <input type="checkbox" 
                                           ${leak.alignsWithDreams ? 'checked' : ''}
                                           onchange="updateLeak('${type}', ${leak.id}, 'alignsWithDreams', this.checked)"
                                           style="width: auto; margin-right: 8px;">
                                    Aproxima dos meus sonhos?
                                </label>
                            </div>
                        </div>

                        <div class="impact-values">
                            <div class="value-box">
                                <div class="value-label">Impacto Anual</div>
                                <div class="value-amount">R$ ${yearlyValue.toLocaleString('pt-BR', {minimumFractionDigits: 0})}</div>
                            </div>
                            <div class="value-box">
                                <div class="value-label">Em 5 Anos</div>
                                <div class="value-amount">R$ ${fiveYearImpact.toLocaleString('pt-BR', {minimumFractionDigits: 0})}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAllLeaks() {
            renderLeaks('automatic');
            renderLeaks('convenience');
            renderLeaks('status');
        }

        function calculateYearlyValue(value, frequency) {
            if (!value) return 0;
            
            switch(frequency) {
                case 'daily':
                    return value * 365;
                case 'weekly':
                    return value * 52;
                case 'monthly':
                default:
                    return value * 12;
            }
        }

        function calculateTopLeaks() {
            // Combinar todos os vazamentos
            const allLeaks = [
                ...data.automatic.map(l => ({...l, type: 'automatic', typeName: 'Autom√°tico'})),
                ...data.convenience.map(l => ({...l, type: 'convenience', typeName: 'Conveni√™ncia'})),
                ...data.status.map(l => ({...l, type: 'status', typeName: 'Status'}))
            ];

            // Calcular impacto anual e ordenar
            const leaksWithImpact = allLeaks.map(leak => ({
                ...leak,
                yearlyImpact: calculateYearlyValue(leak.monthlyValue, leak.frequency),
                score: calculateLeakScore(leak)
            })).sort((a, b) => b.score - a.score);

            // Top 3
            const topLeaks = leaksWithImpact.slice(0, 3);
            
            // Calcular total
            const totalYearly = topLeaks.reduce((sum, leak) => sum + leak.yearlyImpact, 0);
            const totalMonthly = totalYearly / 12;

            // Renderizar resumo
            const summaryContainer = document.getElementById('topLeaksSummary');
            summaryContainer.innerHTML = `
                <div class="summary-title">üéØ Seus 3 Maiores Vazamentos</div>
                
                ${topLeaks.length === 0 ? '<p style="text-align: center; color: #92400e;">Adicione vazamentos nas etapas anteriores para ver o resumo.</p>' : ''}
                
                ${topLeaks.map((leak, index) => `
                    <div class="impact-card ${leak.type}">
                        <div class="impact-header">
                            <div class="impact-title">#${index + 1} - ${leak.name || 'Sem descri√ß√£o'}</div>
                            <div class="impact-badge ${leak.type}">${leak.typeName}</div>
                        </div>
                        <div class="impact-values">
                            <div class="value-box">
                                <div class="value-label">Impacto Anual</div>
                                <div class="value-amount">R$ ${leak.yearlyImpact.toLocaleString('pt-BR', {minimumFractionDigits: 0})}</div>
                            </div>
                            <div class="value-box">
                                <div class="value-label">Em 5 Anos</div>
                                <div class="value-amount">R$ ${(leak.yearlyImpact * 5).toLocaleString('pt-BR', {minimumFractionDigits: 0})}</div>
                            </div>
                            <div class="value-box">
                                <div class="value-label">Satisfa√ß√£o</div>
                                <div class="value-amount">${leak.satisfaction}/10</div>
                            </div>
                        </div>
                    </div>
                `).join('')}

                ${topLeaks.length > 0 ? `
                    <div class="total-leak">
                        <div class="total-leak-label">üí∞ Potencial de Economia Total (Mensal)</div>
                        <div class="total-leak-value">R$ ${totalMonthly.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                        <div class="total-leak-label" style="margin-top: 15px;">üìä Impacto Anual</div>
                        <div style="font-size: 2em; font-weight: 700; color: #dc2626;">R$ ${totalYearly.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                    </div>
                ` : ''}
            `;

            // Renderizar plano de a√ß√£o
            renderActionPlan(topLeaks);
        }

        function calculateLeakScore(leak) {
            // Pontua√ß√£o baseada em: impacto financeiro + baixa satisfa√ß√£o + alinhamento negativo
            const yearlyImpact = calculateYearlyValue(leak.monthlyValue, leak.frequency);
            const satisfactionPenalty = (10 - leak.satisfaction) * 100;
            const reversePenalty = leak.wouldReverse ? 500 : 0;
            const dreamsPenalty = !leak.alignsWithDreams ? 500 : 0;
            
            return yearlyImpact + satisfactionPenalty + reversePenalty + dreamsPenalty;
        }

        function renderActionPlan(topLeaks) {
            const container = document.getElementById('actionPlanContainer');
            
            if (topLeaks.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = `
                <div style="margin-top: 20px;">
                    ${topLeaks.map((leak, index) => `
                        <div class="input-group">
                            <label>A√ß√£o para "${leak.name}":</label>
                            <textarea id="action${index}" 
                                      placeholder="Descreva como voc√™ vai eliminar ou reduzir este vazamento..."
                                      style="min-height: 80px;"></textarea>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Relat√≥rio para impress√£o
        function showPrintView() {
            const printContent = document.getElementById('printContent');
            
            const allLeaks = [
                ...data.automatic.map(l => ({...l, type: 'automatic', typeName: 'Autom√°tico'})),
                ...data.convenience.map(l => ({...l, type: 'convenience', typeName: 'Conveni√™ncia'})),
                ...data.status.map(l => ({...l, type: 'status', typeName: 'Status'}))
            ];

            const leaksWithImpact = allLeaks.map(leak => ({
                ...leak,
                yearlyImpact: calculateYearlyValue(leak.monthlyValue, leak.frequency),
                score: calculateLeakScore(leak)
            })).sort((a, b) => b.score - a.score);

            const topLeaks = leaksWithImpact.slice(0, 3);
            const totalYearly = topLeaks.reduce((sum, leak) => sum + leak.yearlyImpact, 0);
            const totalMonthly = totalYearly / 12;

            let html = `
                <div class="print-header">
                    <h1 style="font-size: 2.5em; margin-bottom: 10px;">üîç Relat√≥rio de Vazamentos Financeiros</h1>
                    <p style="font-size: 1.2em; opacity: 0.95;">Revolu√ß√£o Financeira em 30 Dias</p>
                    <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">${new Date().toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>

                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 3px solid #f59e0b;">
                    <h2 style="color: #92400e; text-align: center; margin-bottom: 20px; font-size: 1.8em;">üí∞ Resumo Executivo</h2>
                    <div style="text-align: center;">
                        <p style="color: #92400e; font-size: 1.2em; margin-bottom: 10px;">Potencial de Economia Mensal</p>
                        <p style="font-size: 3em; font-weight: 700; color: #dc2626;">R$ ${totalMonthly.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                        <p style="color: #92400e; font-size: 1em; margin-top: 15px;">Impacto Anual: <strong style="font-size: 1.5em;">R$ ${totalYearly.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong></p>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                    <h2 style="color: #667eea; margin-bottom: 20px; font-size: 1.8em;">üéØ Top 3 Maiores Vazamentos</h2>
                    
                    ${topLeaks.map((leak, index) => `
                        <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid ${leak.type === 'automatic' ? '#ef4444' : leak.type === 'convenience' ? '#f59e0b' : '#8b5cf6'};">
                            <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 1.3em;">#${index + 1} - ${leak.name || 'Sem descri√ß√£o'}</h3>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Tipo:</strong> ${leak.typeName}</p>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Impacto Anual:</strong> R$ ${leak.yearlyImpact.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Em 5 Anos:</strong> R$ ${(leak.yearlyImpact * 5).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Satisfa√ß√£o:</strong> ${leak.satisfaction}/10</p>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Reverteria o gasto:</strong> ${leak.wouldReverse ? 'Sim' : 'N√£o'}</p>
                            <p style="color: #4a5568; margin: 5px 0;"><strong>Alinha com sonhos:</strong> ${leak.alignsWithDreams ? 'Sim' : 'N√£o'}</p>
                        </div>
                    `).join('')}
                </div>

                <div style="background: #e0e7ff; padding: 25px; border-radius: 12px; border-left: 4px solid #667eea; margin-bottom: 30px;">
                    <h2 style="color: #667eea; margin-bottom: 15px; font-size: 1.5em;">‚úÖ Plano de A√ß√£o Imediato</h2>
                    <ol style="color: #4c51bf; line-height: 2; padding-left: 20px;">
                        <li><strong>Cancele</strong> assinaturas n√£o utilizadas nos pr√≥ximos 7 dias</li>
                        <li><strong>Negocie</strong> taxas banc√°rias com sua institui√ß√£o</li>
                        <li><strong>Substitua</strong> h√°bitos caros por alternativas econ√¥micas</li>
                        <li><strong>Redirecione</strong> a economia para sua Conta Sonhos</li>
                        <li><strong>Monitore</strong> mensalmente para evitar novos vazamentos</li>
                    </ol>
                </div>

                <div style="background: #d1fae5; padding: 25px; border-radius: 12px; border-left: 4px solid #10b981;">
                    <h2 style="color: #065f46; margin-bottom: 15px; font-size: 1.5em;">üéØ Impacto nos Seus Sonhos</h2>
                    <p style="color: #065f46; line-height: 1.8;">
                        Eliminando estes vazamentos, voc√™ poder√° direcionar <strong>R$ ${totalMonthly.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong> mensais 
                        para realizar os sonhos do seu Mapa de Prop√≥sito. Em 5 anos, isso representa <strong>R$ ${(totalYearly * 5).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong> 
                        que estariam vazando silenciosamente!
                    </p>
                </div>

                <div style="text-align: center; margin-top: 40px; padding-top: 30px; border-top: 2px solid #e9ecef; color: #718096;">
                    <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>üí™ Voc√™ est√° no controle!</strong></p>
                    <p style="margin-bottom: 10px;">Continue monitorando e eliminando vazamentos para acelerar a realiza√ß√£o dos seus sonhos.</p>
                    <p style="font-size: 0.9em; margin-top: 20px; color: #667eea;"><strong>Revolu√ß√£o Financeira em 30 Dias</strong></p>
                    <p style="font-size: 0.85em; color: #667eea;">Fernando Martins</p>
                    <p style="font-size: 0.85em; color: #667eea;">Consultor Financeiro</p>
                </div>
            `;

            printContent.innerHTML = html;
            document.getElementById('printView').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePrintView() {
            document.getElementById('printView').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function printReport() {
            window.print();
        }

        // LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('vazamentosFinanceiros', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('vazamentosFinanceiros');
            if (saved) {
                data = JSON.parse(saved);
                renderAllLeaks();
            }
        }

        function restart() {
            if (confirm('Tem certeza que deseja fazer uma nova an√°lise? Os dados atuais ser√£o perdidos.')) {
                localStorage.removeItem('vazamentosFinanceiros');
                location.reload();
            }
        }
    </script>
</body>
</html>
